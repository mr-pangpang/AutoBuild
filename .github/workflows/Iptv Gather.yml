name: TVBOX Update with CMD

on:
  workflow_dispatch:
  schedule:
    - cron: '0 2 * * *'

jobs:
  update:
    runs-on: windows-latest
    
    permissions:
      contents: write
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Download source
      shell: cmd
      run: |
        echo 正在下载直播源...
        curl -s -L "https://tv-1.iill.top/m3u/Gather" -o Gather.txt
        echo 下载完成

    - name: Check file
      shell: cmd
      run: |
        if exist Gather.txt (
          echo 文件已创建
          for /f %%i in ('type Gather.txt ^| find /c /v ""') do set lines=%%i
          echo 文件行数: !lines!
        ) else (
          echo 文件创建失败
        )

    - name: Commit
      shell: cmd
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add Gather.txt
        git commit -m "Update TVBOX" || echo No changes
        git push
