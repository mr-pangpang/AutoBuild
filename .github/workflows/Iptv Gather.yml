name: Update TVBOX Gather Source

on:
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©UTCæ—¶é—´02:00ï¼ˆåŒ—äº¬æ—¶é—´10:00ï¼‰

jobs:
  update-tvbox:
    runs-on: windows-latest  # ä½¿ç”¨Windowsç¯å¢ƒï¼Œä¸æœ¬åœ°ä¸€è‡´
    
    permissions:
      contents: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Download using curl (æ¨¡æ‹Ÿæœ¬åœ°bat)
      shell: cmd  # ä½¿ç”¨CMDï¼Œä¸æœ¬åœ°batä¸€è‡´
      run: |
        echo å¼€å§‹ä¸‹è½½TVBOXç›´æ’­æº...
        curl -s -L "https://tv-1.iill.top/m3u/Gather" -o Gather.txt
        
        echo æ£€æŸ¥ä¸‹è½½ç»“æœ...
        if exist Gather.txt (
          for /f %%i in ('type Gather.txt ^| find /c /v ""') do set lines=%%i
          echo ä¸‹è½½æˆåŠŸï¼æ–‡ä»¶å…± !lines! è¡Œ
          echo æ–‡ä»¶å‰5è¡Œå†…å®¹ï¼š
          set /p firstline=<Gather.txt
          echo !firstline!
        ) else (
          echo ä¸‹è½½å¤±è´¥ï¼Œåˆ›å»ºç©ºæ–‡ä»¶
          echo #EXTM3U > Gather.txt
          echo # ä¸‹è½½å¤±è´¥æ—¶é—´: %date% %time% >> Gather.txt
        )

    - name: Configure Git
      shell: cmd
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"

    - name: Commit and push changes
      shell: cmd
      run: |
        git add Gather.txt
        git diff --staged --quiet
        if errorlevel 1 (
          git commit -m "ğŸ“º æ›´æ–°TVBOXç›´æ’­æº - %date% %time%"
          git push
          echo âœ… æ›´æ–°æˆåŠŸå¹¶æ¨é€åˆ°ä»“åº“
        ) else (
          echo ğŸŸ¡ å†…å®¹æ— å˜åŒ–ï¼Œè·³è¿‡æäº¤
        )
