name: Download and Build FongMi TV

on:
  workflow_dispatch:  # 仅手动触发
  schedule:
    - cron: '0 3 * * *'  # 每天凌晨3点

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Download source code
      run: |
        wget https://github.com/FongMi/tv/archive/refs/heads/main.zip -O source.zip
        unzip source.zip -d .
        mv tv-main/* .
        ls -la

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Setup Gradle
      uses: gradle/actions/setup-gradle@v3

    - name: Build APK
      run: |
        chmod +x ./gradlew
        ./gradlew assembleRelease

    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: FongMi-TV-Build
        path: app/build/outputs/apk/release/*.apk
