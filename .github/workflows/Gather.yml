name: Auto Gather & Update TV Content
on:
  schedule:
    - cron: "0 */6 * * *"  # UTC每6小时执行
  workflow_dispatch:
    inputs:
      reason:
        description: "手动触发原因"
        required: false
        default: "手动更新TV内容"

jobs:
  gather-tv-content:
    runs-on: windows-latest
    steps:
      - name: Checkout Repository Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 👇 修复后的curl安装步骤（GitHub镜像）👇
      - name: Install & Configure curl (via GitHub Mirror)
        run: |
          $curlZipUrl = "https://github.com/curl/curl-for-win/releases/latest/download/curl-8.9.1_7-win64-mingw.zip"
          Invoke-WebRequest -Uri $curlZipUrl -OutFile "curl.zip" -UseBasicParsing -TimeoutSec 60
          Expand-Archive -Path "curl.zip" -DestinationPath "C:\curl" -Force
          $curlBinPath = Get-ChildItem -Path "C:\curl" -Recurse -Filter "bin" | Select-Object -First 1 | ForEach-Object { $_.FullName }
          echo $curlBinPath | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8
          curl --version
        shell: pwsh

      - name: Run Gather.bat to Fetch Content
        working-directory: ./script
        run: |
          echo "当前工作目录：$(Get-Location)"
          cmd /c .\Gather.bat
          if (Test-Path "fetch-tv-log.txt") {
            echo "===== Gather.bat 执行日志 ====="
            Get-Content "fetch-tv-log.txt"
            echo "=============================="
          }

      # 后续提交推送步骤不变...
