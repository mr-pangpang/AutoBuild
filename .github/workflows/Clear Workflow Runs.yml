name: 'Clear Workflow Runs'
on:
  workflow_dispatch: # 允许手动触发此工作流
    inputs:
      retain_days:
        description: '保留最近多少天的运行记录？'
        required: true
        default: '7'
        type: number
  schedule:
    # 每天 UTC 时间 00:00 运行一次（北京时间 08:00）
    - cron: '0 0 * * *'

jobs:
  cleanup:
    runs-on: ubuntu-latest
    permissions:
      # 必须授予删除权限
      actions: write
    steps:
      - name: Delete old workflow runs
        uses: actions/delete-workflow-runs@v2
        with:
          # 对于手动触发，使用手动输入的参数
          retain_days: ${{ github.event.inputs.retain_days || 30 }}
          # 要删除哪个工作流的记录？留空则默认为当前工作流（即这个清理工作流本身）
          # 如果你想清理其他工作流，在这里指定其文件名（不包含路径）
          # workflow_name: your-other-workflow-name.yml
          keep_minimum_runs: 5 # 无论如何，至少为每个工作流保留最近的 N 次运行
